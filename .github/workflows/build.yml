name: Build Windows EXE

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install keyboard pyautogui pytesseract pillow opencv-python pyttsx3 pyinstaller
    
    - name: Build EXE
      run: |
        pyinstaller --onefile --windowed --icon=icon.ico --add-data "words.json;." --name "WordAutofiller" main.py
    
    - name: Upload to Discord
      env:
        DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      shell: pwsh
      run: |
        $webhook = $env:DISCORD_WEBHOOK
        $file = "dist/WordAutofiller.exe"
        
        # Send embed
        $embed = @{
          title = "âœ… Build Complete"
          description = "New WordAutofiller.exe ready!"
          color = 3066993
          timestamp = (Get-Date).ToUniversalTime().ToString("o")
        }
        
        $payload = @{ embeds = @($embed) } | ConvertTo-Json -Depth 4
        Invoke-RestMethod -Uri $webhook -Method Post -Body $payload -ContentType 'application/json'
        
        # Upload file
        curl.exe -F "file=@$file" $webhook
    
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: WordAutofiller-Windows
        path: dist/WordAutofiller.exe
